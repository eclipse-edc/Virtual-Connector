<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="581px" height="321px" viewBox="-0.5 -0.5 581 321" style="background: transparent; background-color: transparent;" content="&lt;mxfile host=&quot;65bd71144e&quot;&gt;&lt;diagram id=&quot;scenario3-multi-node-nats-sql&quot; name=&quot;Page-1&quot;&gt;&lt;mxGraphModel&gt;&lt;root&gt;&lt;mxCell id=&quot;0&quot;/&gt;&lt;mxCell id=&quot;1&quot; parent=&quot;0&quot;/&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;&lt;/diagram&gt;&lt;/mxfile&gt;">
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#666666"/>
        </marker>
    </defs>
    <g>
        <!-- Control Plane 1 -->
        <rect x="0" y="0" width="180" height="100" fill="#f5f5f5" stroke="#666666" stroke-width="1.5"/>
        <text x="90" y="15" font-family="Helvetica, Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#333333">Control Plane 1</text>
        <text x="90" y="28" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#333333">(Task Publishers)</text>
        <rect x="10" y="38" width="160" height="55" rx="6" ry="6" fill="#dae8fc" stroke="#6c8ebf" stroke-width="1.5"/>
        <text x="90" y="53" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">State Machines</text>
        <text x="90" y="66" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">TaskStateListeners</text>
        <text x="90" y="79" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">NatsTaskPublisher</text>

        <!-- Control Plane N -->
        <rect x="0" y="115" width="180" height="100" fill="#f5f5f5" stroke="#666666" stroke-width="1.5"/>
        <text x="90" y="130" font-family="Helvetica, Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#333333">Control Plane N</text>
        <text x="90" y="143" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#333333">(Task Publishers)</text>
        <rect x="10" y="153" width="160" height="55" rx="6" ry="6" fill="#dae8fc" stroke="#6c8ebf" stroke-width="1.5"/>
        <text x="90" y="168" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">State Machines</text>
        <text x="90" y="181" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">TaskStateListeners</text>
        <text x="90" y="194" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">NatsTaskPublisher</text>

        <!-- Arrows from Control Planes to NATS -->
        <path d="M 180 65 L 210 65 L 210 115 L 230 115" stroke="#666666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)"/>
        <path d="M 180 180 L 210 180 L 210 115" stroke="#666666" stroke-width="1.5" fill="none"/>

        <!-- NATS JetStream -->
        <rect x="230" y="75" width="150" height="90" rx="8" ry="8" fill="#fff2cc" stroke="#d6b656" stroke-width="1.5"/>
        <text x="305" y="95" font-family="Helvetica, Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#000000">NATS JetStream</text>
        <text x="305" y="110" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">(Streams)</text>
        <text x="305" y="128" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">cn-stream</text>
        <text x="305" y="143" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">tp-stream</text>

        <!-- Arrows from NATS to Workers -->
        <path d="M 380 100 L 395 100 L 395 50 L 410 50" stroke="#666666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)"/>
        <path d="M 380 100 L 395 100 L 395 50 L 485 50 L 485 50 L 485 50" stroke="#666666" stroke-width="1.5" fill="none"/>
        <path d="M 485 50 L 500 50" stroke="#666666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)"/>
        <path d="M 380 140 L 395 140 L 395 115 L 410 115" stroke="#666666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)"/>
        <path d="M 380 140 L 395 140 L 395 115 L 500 115" stroke="#666666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)"/>

        <!-- Worker 1 (CN) -->
        <rect x="410" y="25" width="70" height="50" rx="6" ry="6" fill="#f8cecc" stroke="#b85450" stroke-width="1.5"/>
        <text x="445" y="45" font-family="Helvetica, Arial, sans-serif" font-size="10" text-anchor="middle" fill="#000000">Wkr 1</text>
        <text x="445" y="60" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">CN Sub</text>

        <!-- Worker 2 (CN) -->
        <rect x="500" y="25" width="70" height="50" rx="6" ry="6" fill="#f8cecc" stroke="#b85450" stroke-width="1.5"/>
        <text x="535" y="45" font-family="Helvetica, Arial, sans-serif" font-size="10" text-anchor="middle" fill="#000000">Wkr 2</text>
        <text x="535" y="60" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">CN Sub</text>

        <!-- Worker 3 (TP) -->
        <rect x="410" y="90" width="70" height="50" rx="6" ry="6" fill="#d5e8d4" stroke="#82b366" stroke-width="1.5"/>
        <text x="445" y="110" font-family="Helvetica, Arial, sans-serif" font-size="10" text-anchor="middle" fill="#000000">Wkr 3</text>
        <text x="445" y="125" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">TP Sub</text>

        <!-- Worker N (TP) -->
        <rect x="500" y="90" width="70" height="50" rx="6" ry="6" fill="#d5e8d4" stroke="#82b366" stroke-width="1.5"/>
        <text x="535" y="110" font-family="Helvetica, Arial, sans-serif" font-size="10" text-anchor="middle" fill="#000000">Wkr N</text>
        <text x="535" y="125" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">TP Sub</text>

        <!-- Arrows from Workers to PostgreSQL -->
        <path d="M 445 75 L 445 170 L 360 170 L 360 220" stroke="#666666" stroke-width="1.5" fill="none"/>
        <path d="M 535 75 L 535 170 L 360 170" stroke="#666666" stroke-width="1.5" fill="none"/>
        <path d="M 445 140 L 445 170" stroke="#666666" stroke-width="1.5" fill="none"/>
        <path d="M 535 140 L 535 170" stroke="#666666" stroke-width="1.5" fill="none"/>
        <path d="M 360 170 L 360 220" stroke="#666666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)"/>

        <!-- PostgreSQL cylinder -->
        <path d="M 260 240 Q 260 220 360 220 Q 460 220 460 240 L 460 295 Q 460 315 360 315 Q 260 315 260 295 Z" fill="#f5f5f5" stroke="#666666" stroke-width="1.5"/>
        <ellipse cx="360" cy="240" rx="100" ry="20" fill="#f5f5f5" stroke="#666666" stroke-width="1.5"/>
        <text x="360" y="265" font-family="Helvetica, Arial, sans-serif" font-size="10" text-anchor="middle" fill="#000000">PostgreSQL</text>
        <text x="360" y="280" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">(Shared TaskDB)</text>
        <text x="360" y="295" font-family="Helvetica, Arial, sans-serif" font-size="9" text-anchor="middle" fill="#000000">(State DBs)</text>
    </g>
</svg>
